{% extends "base.html" %}

{% block title %}Register - Happy Paws Vet Clinic{% endblock %}

{% block content %}
<div class="form-wrapper">
    <div class="form-box">
        <h2 class="text-center mb-4">
            <i class="fas fa-user-plus me-2"></i>Join Happy Paws
        </h2>
        <p class="text-center text-muted mb-4">Create your account to access our veterinary services</p>

        <form method="POST" id="registerForm">
            {{ form.hidden_tag() }}

            <div class="form-group mb-3">
                <label for="name" class="form-label">
                    <i class="fas fa-user me-2"></i>Full Name
                </label>
                {{ form.name(class="form-control", placeholder="Enter your full name") }}
                {% if form.name.errors %}
                    <div class="text-danger small">
                        {% for error in form.name.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="form-group mb-3">
                <label for="email" class="form-label">
                    <i class="fas fa-envelope me-2"></i>Email Address
                </label>
                {{ form.email(class="form-control", placeholder="Enter your email") }}
                {% if form.email.errors %}
                    <div class="text-danger small">
                        {% for error in form.email.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="form-group mb-3">
                <label for="password" class="form-label">
                    <i class="fas fa-lock me-2"></i>Password
                </label>
                {{ form.password(class="form-control", placeholder="Create a password") }}
                {% if form.password.errors %}
                    <div class="text-danger small">
                        {% for error in form.password.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="form-group mb-3">
                <label for="password2" class="form-label">
                    <i class="fas fa-lock me-2"></i>Confirm Password
                </label>
                {{ form.password2(class="form-control", placeholder="Confirm your password") }}
                {% if form.password2.errors %}
                    <div class="text-danger small">
                        {% for error in form.password2.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="form-group mb-4">
                <label for="otp" class="form-label">
                    <i class="fas fa-key me-2"></i>OTP Code
                </label>
                {{ form.otp(class="form-control", placeholder="Enter OTP sent to your email") }}
                {% if form.otp.errors %}
                    <div class="text-danger small">
                        {% for error in form.otp.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="d-grid">
                {{ form.submit(class="btn btn-primary btn-lg") }}
            </div>
        </form>

        <div id="message" class="mt-3"></div>

        <div class="text-center mt-4">
            <p class="mb-0">Already have an account?
                <a href="#" data-bs-toggle="modal" data-bs-target="#authModal" class="text-primary fw-semibold">Login here</a>
            </p>
        </div>
    </div>
</div>

<script>
document.getElementById('registerForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    fetch('/register', {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            if (data.require_otp) {
                window.location.href = '/verify_otp';
            } else {
                document.getElementById('message').innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>' + data.message + '</div>';
            }
        } else {
            document.getElementById('message').innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>' + data.message + '</div>';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('message').innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>An error occurred. Please try again.</div>';
    });
});
</script>
{% endblock %}
